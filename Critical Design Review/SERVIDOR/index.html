<html>
	<head>
		<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<title>UPC Manager</title>
		<style type="text/css">
			#results_hidden{ display:none; }
			#results{padding: 15px;}
		</style>
		<script type="text/javascript">
			 function on_button() {
					var xhttp = new XMLHttpRequest();
					var query = document.getElementsByName('entry')[0].value
					if (!query.includes('?')){
						query = query + '?';
					}
					query = query + "&uid=" + document.getElementsByName('uid')[0].value
					xhttp.onreadystatechange = function() {
						 if (this.readyState == 4 && this.status == 200) {
							if(this.responseText== "[]"){
								document.getElementById("alerts").setAttribute("class", "alert alert-danger ");
								document.getElementById("alerts").style.visibility = "";
								document.getElementById("alert_text").innerHTML = "<strong>Oh snap!</strong> The UID or the reqeusted information must be wrong."
								document.getElementById("results").setAttribute("id", "results_hidden");
							}else{
								get_name() 
								CreateTableFromJSON(JSON.parse(this.responseText), query.split("?")[0]) 
							}
						 }
					};
					xhttp.open("POST", query, true);
					xhttp.setRequestHeader("Content-type", "application/json");
					xhttp.send("JSON Data");
				}
				
				function get_name() {
					var xhttp = new XMLHttpRequest();
					var query ="Users?&uid=" + document.getElementsByName('uid')[0].value;
					var text = "<strong>Everything Ok!</strong> This is the information you requested, ";
					xhttp.onreadystatechange = function() {
						 if (this.readyState == 4 && this.status == 200) {
							text = text + JSON.parse(this.responseText)[0]["user_name"];
							text = text + '.';
							document.getElementById("alerts").setAttribute("class", "alert alert-success ");
							document.getElementById("alerts").style.visibility = "";
							document.getElementById("alert_text").innerHTML = text;
						 }
					};
					xhttp.open("POST", query, true);
					xhttp.setRequestHeader("Content-type", "application/json");
					xhttp.send("JSON Data");
				}

				function CreateTableFromJSON(data, title) {
						document.getElementById("greeter").innerHTML = title;
						var col = [];
						for (var i = 0; i < data.length; i++) {
							for (var key in data[i]) {
								if (col.indexOf(key) === -1) {
								    col.push(key);
								}
							}
						}

						var table = document.createElement("table");
						table.setAttribute("class", "table");
						var tr = table.insertRow(-1);              

						for (var i = 0; i < col.length; i++) {
							var th = document.createElement("th");   
							th.innerHTML = col[i];
							tr.appendChild(th);
						}

						for (var i = 0; i < data.length; i++) {

							tr = table.insertRow(-1);

							for (var j = 0; j < col.length; j++) {
								var tabCell = tr.insertCell(-1);
								tabCell.innerHTML = data[i][col[j]];
							}
					}
				
					var divContainer = document.getElementById("showData");
					divContainer.innerHTML = "";
					
					divContainer.appendChild(table);
					document.getElementById("results_hidden").setAttribute("id", "results");
				}
				function on_cross(){
					document.getElementById("alerts").style.visibility = "hidden";
				}
				document.addEventListener('keyup', function(event) {
					if(event.keyCode == 13) {
						on_button()
					}
					else if(event.keyCode == 39) {
						alert('I would love to say thank you\nto my PBE colleagues <3\n\n(c) by IAG+L');
					}else if(event.keyCode == 37) {
        				alert('4B82F395');
  					}
				});
		</script> 
	</head>
   
   <body>
		
	<div class="page">
		<div class="page-header" align=center>

			<h1>Welcome to MareNostrums Web Server <br><small>An IAG+L project</small></h1>
		</div>
		<div class="container" >
			<div class="row" >
				<div class="alert alert-info" role="alert" id="alerts" >
			<div id = "alert_text"><strong>Tip:</strong> Collection?constrain1=value1&constrain2=values2... And do not forget your card at home!</div>
			</div>
			</div>
		  <div class="row">
			<div class="col-sm-2">
				<input type="text" class="form-control" placeholder="Enter your UID..." name="uid"  size="6">
			</div>
			<div class="col-sm-10">
			  <div class="input-group">
			  <input type="text" class="form-control" name="entry" placeholder="Enter your query..." >
			  <span class="input-group-btn">
				<button class="btn btn-default" type="button" onclick="on_button()">Go, Jonny Go!</button>
			  </span>
			</div><!-- /input-group -->
			</div>
		  </div>
		<div class="row" id="results_hidden">
			<div class="panel panel-default">
		  	<!-- Default panel contents -->
		  	<div class="panel-heading" id="greeter" ></div>
		  	<!-- Table -->
		  	<div id="showData">
		  	</div>
		</div>
		</div>
		</div>
	</div>
		
   </body>
</html>
